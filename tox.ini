[tox]
isolated_build = true
envlist = black, ruff, mypy, pytest, bandit
#envlist = pytest

[testenv]
allowlist_externals = poetry
commands =
    poetry install -v

[testenv:black]
description = 'Check code style with Black'
commands = poetry run black src/ukrdc_cupid --check

[testenv:ruff]
description = 'Execute static analysis with ruff.'
commands = poetry run ruff src/ukrdc_cupid

[testenv:mypy]
description = 'Execute static analysis with mypy (type annotations).'

plugins = pydantic.mypy

deps = 
    mypy
    sqlalchemy2-stubs
    lxml-stubs

commands = poetry run mypy src/ukrdc_cupid


[testenv:pytest]
description = "run unit tests"
deps =  pytest-cov
    pytest_postgresql
commands = poetry install -v 
    poetry run pytest --cov-report term-missing --cov={toxinidir}/src/ukrdc_cupid

[testenv:bandit]
description = 'Execute static analysis with bandit.'
commands = poetry run bandit -r src/ukrdc_cupid
